<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Voice Admin</title>
<style>body{font-family:system-ui;margin:2rem;max-width:840px}label{display:block;margin-top:.75rem}input,select,textarea{width:100%;padding:.4rem}button{margin-top:1rem;padding:.5rem 1rem}</style>
</head>
<body>
<h1>Voice Admin</h1>
<section>
  <h2>1) Download a Piper voice</h2>
  <p>Paste a <code>voice_id</code> from <a target="_blank" href="https://huggingface.co/rhasspy/piper-voices">rhasspy/piper-voices</a> (e.g., <code>en_GB-kathleen-high</code>) and click download.</p>
  <form id="dlForm"><label>Voice ID <input name="voice_id" placeholder="en_GB-kathleen-high" required /></label><button type="submit">Download</button></form>
  <pre id="dlOut"></pre>
  <details><summary>Local voices dir</summary><code>/voices</code> (repo root)</details>
  <hr />
</section>
<section>
  <h2>2) Trial synthesis (TTS → FX → stream)</h2>
  <form id="trialForm">
    <label>Voice ID or local .onnx path <input name="voice_id" placeholder="en_GB-kathleen-high or ./voices/en_GB-kathleen-high.onnx" required /></label>
    <label>Preset <select name="preset"><option>wizard</option><option>robot</option><option>fairy</option><option>goblin</option><option>none</option></select></label>
    <details><summary>Advanced (Piper + FX params)</summary>
      <label>speaker_id (int, optional) <input name="speaker_id" /></label>
      <label>length_scale (e.g., 0.96) <input name="length_scale" value="0.96" /></label>
      <label>noise_scale (e.g., 0.6) <input name="noise_scale" value="0.6" /></label>
      <label>noise_w (e.g., 0.8) <input name="noise_w" value="0.8" /></label>
      <label>FX overrides (JSON) <input name="fx_overrides" placeholder='{"pitch_semitones":-3,"wet":0.3}' /></label>
    </details>
    <label>Text to speak <textarea name="text" rows="3">Welcome back to the AI Learning Lab!</textarea></label>
    <button type="submit">Stream Trial</button>
  </form>
  <audio id="player" controls></audio>
  <pre id="trialOut"></pre>
</section>
<script>
const q = s => document.querySelector(s);
q('#dlForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const r = await fetch('/lab/admin/download', { method: 'POST', body: fd });
  q('#dlOut').textContent = await r.text();
});
q('#trialForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const r = await fetch('/lab/tts/stream', { method: 'POST', body: fd });
  if (!r.ok) {
    const msg = await r.text();
    q('#trialOut').textContent = `Error: ${r.status} ${r.statusText}\n${msg}`;
    return;
  }
  q('#trialOut').textContent = '';
  const blob = await r.blob();
  const url = URL.createObjectURL(blob);
  const audio = q('#player');
  audio.src = url; audio.play();
});
</script>
</body>
</html>
